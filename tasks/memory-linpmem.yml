---

- stat: path={{ bin_pathÂ }}/linpmem_2.0.1
  register: linpmem
- name: Linpmem download
  get_url: url=https://github.com/google/rekall/releases/download/v1.3.2/linpmem_2.0.1.gz
    dest={{ bin_path }}/linpmem_2.0.1.gz
    mode=0400
  when: not linpmem.stat.exists and (memcapture_download is defined and memcapture_download)

- name: Extract linpmem
  command: "gunzip {{ bin_path }}/linpmem_2.0.1.gz chdir={{ bin_path }}"
## require unzip to be installed
#  unarchive: src="{{ bin_path }}/linpmem_2.0.1.gz" dest="{{ bin_path }}" copy=no
  when: not linpmem.stat.exists

- file: "path={{ bin_path }}/linpmem_2.0.1 mode=0700"
- stat: path={{ dst_path }}/{{ prefix }}-memory-linpmem.aff4
  register: memcapture2
- name: memory capture (linpmem)
  command: "{{ item }} chdir={{ bin_path }}"
  become: yes
  with_items:
    - ./linpmem_2.0.1 -o {{ dst_path }}/{{ prefix }}-memory-linpmem.aff4
  when: not memcapture2.stat.exists
  ignore_errors: true

